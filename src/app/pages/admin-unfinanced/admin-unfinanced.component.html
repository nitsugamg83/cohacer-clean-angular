<div *ngIf="loading" class="loading">Cargando usuarios...</div>
<div *ngIf="error" class="error">Error: {{ error }}</div>

<div *ngIf="!loading && !error">
  <h1>Usuarios sin financiamiento</h1>

  <div class="search-container">
    <input
      type="text"
      [(ngModel)]="searchTerm"
      placeholder="Buscar por nombre, empresa, carrera o email..."
      class="search-box"
    />
    <span class="search-icon" (click)="applyFilter()">游댌</span>
  </div>

  <div class="pagination" *ngIf="totalPages > 1">
    <span>P치gina {{ currentPage }} de {{ totalPages }}</span>
    <button (click)="prevPage()" [disabled]="currentPage === 1">Anterior</button>
    <button (click)="nextPage()" [disabled]="currentPage === totalPages">Siguiente</button>
  </div>

  <div *ngIf="paginatedEnrolls.length === 0">
    <p>No hay usuarios sin financiamiento.</p>
  </div>

  <div class="cards">
    <div *ngFor="let enroll of paginatedEnrolls" class="card">
      <h3>{{ enroll.user?.name }}</h3>
      <p><strong>Empresa:</strong> {{ enroll.company?.name }}</p>
      <p><strong>Carrera:</strong> {{ enroll.career?.name }}</p>
      <p><strong>Email:</strong> {{ enroll.user?.email }}</p>
      <button (click)="onEdit(enroll)">Editar</button>
    </div>
  </div>

  <div *ngIf="selectedEnroll" class="modal">
    <form (ngSubmit)="onSubmit()" #finForm="ngForm">
      <h3>Editar financiamiento</h3>

      <label>Monto visible para el usuario:</label>
      <input
        type="number"
        [(ngModel)]="selectedEnroll.financial.visibleToUser"
        name="visibleToUser"
        required
      />

      <label>Descuento:</label>
      <input
        type="number"
        [(ngModel)]="selectedEnroll.financial.discount"
        name="discount"
        required
      />

      <label>Candado inscripci칩n:</label>
      <input
        type="number"
        [(ngModel)]="selectedEnroll.financial.locks.inscription"
        name="inscription"
      />

      <label>Candado clases:</label>
      <input
        type="number"
        [(ngModel)]="selectedEnroll.financial.locks.classes"
        name="classes"
      />

      <label>Candado simulaciones:</label>
      <input
        type="number"
        [(ngModel)]="selectedEnroll.financial.locks.simulations"
        name="simulations"
      />

      <label>Candado ex치menes:</label>
      <input
        type="number"
        [(ngModel)]="selectedEnroll.financial.locks.tests"
        name="tests"
      />

      <label>Candado certificaci칩n:</label>
      <input
        type="number"
        [(ngModel)]="selectedEnroll.financial.locks.certification"
        name="certification"
      />

      <button type="submit">Guardar</button>
      <button type="button" (click)="selectedEnroll = null">Cancelar</button>
    </form>
  </div>
</div>
