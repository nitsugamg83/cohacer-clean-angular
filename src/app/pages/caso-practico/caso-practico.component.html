<ng-container *ngIf="loading; else content">
  <div style="text-align: center; padding: 2rem;">
    <mat-spinner></mat-spinner>
    <p>{{ loading }}</p>
  </div>
</ng-container>

<ng-template #content>
  <mat-card>
    <mat-card-title>Caso Pr√°ctico</mat-card-title>
    <mat-card-content>
      <p><strong>Nombre:</strong> {{ data.name }}</p>
      <p><strong>Carrera:</strong> {{ data.career }}</p>
    </mat-card-content>
  </mat-card>

  <app-portada-form
    [title]="practicalCase.title"
    [image]="practicalCase.image"
    (save)="onSavePortada($event.title, $event.image)">
  </app-portada-form>

  <ng-container *ngFor="let key of sectionKeys">
    <ng-container *ngIf="key !== 'development'">
      <mat-card>
        <mat-card-title>{{ sectionTitleMap[key] || key }}</mat-card-title>
        <mat-card-content>
          <textarea [(ngModel)]="sectionTexts[key]" rows="6" style="width:100%"></textarea>
          <button mat-stroked-button color="primary"
                  (click)="onSaveSection(practicalCase.sections[key]._id, [{ type: 'paragraph', data: { content: sectionTexts[key] } }])">
            Guardar {{ sectionTitleMap[key] || key }}
          </button>
        </mat-card-content>
      </mat-card>
    </ng-container>
  </ng-container>

  <mat-card>
    <mat-card-title>Desarrollo</mat-card-title>
    <mat-card-content>
      <ng-container *ngFor="let sub of practicalCase.sections.development.subsections">
        <mat-card style="margin-top: 1rem;">
          <mat-card-title>{{ sub.name }}</mat-card-title>
          <mat-card-content>
            <textarea [(ngModel)]="subsectionTexts[sub._id]" rows="6" style="width:100%"></textarea>
            <button mat-stroked-button color="primary"
                    (click)="onSaveSection(practicalCase.sections.development._id, [{ type: 'paragraph', data: { content: subsectionTexts[sub._id] } }], sub.name)">
              Guardar {{ sub.name }}
            </button>
          </mat-card-content>
        </mat-card>
      </ng-container>
    </mat-card-content>
  </mat-card>

  <div style="margin-top: 2rem;">
    <button mat-raised-button color="accent" (click)="viewPreview()">Vista previa</button>
  </div>
</ng-template>
